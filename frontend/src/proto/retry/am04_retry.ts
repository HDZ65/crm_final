// Code generated by protoc-gen-ts_proto. DO NOT EDIT.
// versions:
//   protoc-gen-ts_proto  v1.181.2
//   protoc               unknown
// source: retry/am04_retry.proto

/* eslint-disable */

/** Rejection reason codes (SEPA return reason codes) */
export enum RejectionReasonCode {
  REJECTION_REASON_CODE_UNSPECIFIED = 0,
  /** AM04_ACCOUNT_CLOSED - AM04 - Account closed/invalid - RETRYABLE */
  AM04_ACCOUNT_CLOSED = 1,
  /** AC04_ACCOUNT_CLOSED - Other retryable codes */
  AC04_ACCOUNT_CLOSED = 2,
  /** AC06_ACCOUNT_BLOCKED - Account blocked */
  AC06_ACCOUNT_BLOCKED = 3,
  /** AG01_TRANSACTION_FORBIDDEN - Transaction forbidden */
  AG01_TRANSACTION_FORBIDDEN = 4,
  /** AG02_INVALID_FORMAT - Invalid bank operation code */
  AG02_INVALID_FORMAT = 5,
  /** BE04_MISSING_CREDITOR_ADDRESS - Missing creditor address */
  BE04_MISSING_CREDITOR_ADDRESS = 6,
  /** FF01_INVALID_FILE_FORMAT - Invalid file format */
  FF01_INVALID_FILE_FORMAT = 7,
  /** MD01_NO_MANDATE - No mandate */
  MD01_NO_MANDATE = 8,
  /** MD02_MISSING_MANDATORY_INFO - Missing mandatory infos */
  MD02_MISSING_MANDATORY_INFO = 9,
  /** MD06_REFUND_REQUEST - Refund request by end customer */
  MD06_REFUND_REQUEST = 10,
  /** MD07_END_CUSTOMER_DECEASED - End customer deceased */
  MD07_END_CUSTOMER_DECEASED = 11,
  /** MS02_NOT_SPECIFIED_REASON - Reason not specified by customer */
  MS02_NOT_SPECIFIED_REASON = 12,
  /** MS03_AGENT_REASON - Reason not specified by agent */
  MS03_AGENT_REASON = 13,
  /** RC01_INVALID_BIC - Bank identifier incorrect */
  RC01_INVALID_BIC = 14,
  /** RR01_MISSING_DEBTOR_ACCOUNT - Missing debtor account/ID */
  RR01_MISSING_DEBTOR_ACCOUNT = 15,
  /** RR02_MISSING_DEBTOR_NAME - Missing debtor name/address */
  RR02_MISSING_DEBTOR_NAME = 16,
  /** RR03_MISSING_CREDITOR_NAME - Missing creditor name/address */
  RR03_MISSING_CREDITOR_NAME = 17,
  /** RR04_REGULATORY_REASON - Regulatory reason */
  RR04_REGULATORY_REASON = 18,
  /** SL01_SPECIFIC_SERVICE_PROVIDER - Due to specific service offered */
  SL01_SPECIFIC_SERVICE_PROVIDER = 19,
  /** TM01_CUT_OFF_TIME - File received after cut-off time */
  TM01_CUT_OFF_TIME = 20,
  /** AC01_IBAN_INVALID - Non-retryable codes */
  AC01_IBAN_INVALID = 50,
  /** AC13_DEBTOR_ACCOUNT_TYPE - Invalid debtor account type - NOT RETRYABLE */
  AC13_DEBTOR_ACCOUNT_TYPE = 51,
  /** CNOR_CREDITOR_NOT_ON_WHITELIST - Creditor bank not registered - NOT RETRYABLE */
  CNOR_CREDITOR_NOT_ON_WHITELIST = 52,
  /** DNOR_DEBTOR_NOT_ON_WHITELIST - Debtor bank not registered - NOT RETRYABLE */
  DNOR_DEBTOR_NOT_ON_WHITELIST = 53,
  /** FF05_DUPLICATE_ENTRY - Duplicate - NOT RETRYABLE */
  FF05_DUPLICATE_ENTRY = 54,
  /** FOCR_FOLLOWING_CANCELLATION - Following cancellation request - NOT RETRYABLE */
  FOCR_FOLLOWING_CANCELLATION = 55,
  UNRECOGNIZED = -1,
}

/** Retry eligibility decision */
export enum RetryEligibility {
  RETRY_ELIGIBILITY_UNSPECIFIED = 0,
  /** ELIGIBLE - Can retry */
  ELIGIBLE = 1,
  /** NOT_ELIGIBLE_REASON_CODE - Reason code is non-retryable */
  NOT_ELIGIBLE_REASON_CODE = 2,
  /** NOT_ELIGIBLE_MAX_ATTEMPTS - Max attempts reached */
  NOT_ELIGIBLE_MAX_ATTEMPTS = 3,
  /** NOT_ELIGIBLE_PAYMENT_SETTLED - Payment already settled elsewhere */
  NOT_ELIGIBLE_PAYMENT_SETTLED = 4,
  /** NOT_ELIGIBLE_CONTRACT_CANCELLED - Contract cancelled */
  NOT_ELIGIBLE_CONTRACT_CANCELLED = 5,
  /** NOT_ELIGIBLE_MANDATE_REVOKED - Mandate revoked */
  NOT_ELIGIBLE_MANDATE_REVOKED = 6,
  /** NOT_ELIGIBLE_CLIENT_BLOCKED - Client blocked/blacklisted */
  NOT_ELIGIBLE_CLIENT_BLOCKED = 7,
  /** NOT_ELIGIBLE_MANUAL_CANCEL - Manually cancelled by admin */
  NOT_ELIGIBLE_MANUAL_CANCEL = 8,
  UNRECOGNIZED = -1,
}

/** Retry attempt status */
export enum RetryAttemptStatus {
  RETRY_ATTEMPT_STATUS_UNSPECIFIED = 0,
  /** SCHEDULED - Planned for future date */
  SCHEDULED = 1,
  /** IN_PROGRESS - Currently being processed */
  IN_PROGRESS = 2,
  /** SUBMITTED - Submitted to PSP, awaiting confirmation */
  SUBMITTED = 3,
  /** SUCCEEDED - Payment successful */
  SUCCEEDED = 4,
  /** FAILED - Payment failed (may trigger next retry) */
  FAILED = 5,
  /** CANCELLED - Manually cancelled */
  CANCELLED = 6,
  /** SKIPPED - Skipped due to condition (e.g., payment settled) */
  SKIPPED = 7,
  UNRECOGNIZED = -1,
}

/** Retry job status (scheduler batch) */
export enum RetryJobStatus {
  RETRY_JOB_STATUS_UNSPECIFIED = 0,
  /** JOB_PENDING - Waiting to be picked up */
  JOB_PENDING = 1,
  /** JOB_RUNNING - Currently executing */
  JOB_RUNNING = 2,
  /** JOB_COMPLETED - Finished successfully */
  JOB_COMPLETED = 3,
  /** JOB_FAILED - Failed with errors */
  JOB_FAILED = 4,
  /** JOB_PARTIAL - Completed with some failures */
  JOB_PARTIAL = 5,
  UNRECOGNIZED = -1,
}

/** Reminder channel */
export enum ReminderChannel {
  REMINDER_CHANNEL_UNSPECIFIED = 0,
  EMAIL = 1,
  SMS = 2,
  /** PHONE_CALL - Task for call center */
  PHONE_CALL = 3,
  PUSH_NOTIFICATION = 4,
  POSTAL_MAIL = 5,
  UNRECOGNIZED = -1,
}

/** Reminder status */
export enum ReminderStatus {
  REMINDER_STATUS_UNSPECIFIED = 0,
  /** REMINDER_PENDING - Queued for sending */
  REMINDER_PENDING = 1,
  /** REMINDER_SENT - Sent to provider */
  REMINDER_SENT = 2,
  /** REMINDER_DELIVERED - Confirmed delivered */
  REMINDER_DELIVERED = 3,
  /** REMINDER_FAILED - Delivery failed */
  REMINDER_FAILED = 4,
  /** REMINDER_CANCELLED - Cancelled before sending */
  REMINDER_CANCELLED = 5,
  /** REMINDER_BOUNCED - Bounced (email) */
  REMINDER_BOUNCED = 6,
  /** REMINDER_OPENED - Opened (email tracking) */
  REMINDER_OPENED = 7,
  /** REMINDER_CLICKED - Link clicked (email tracking) */
  REMINDER_CLICKED = 8,
  UNRECOGNIZED = -1,
}

/** Reminder trigger type */
export enum ReminderTrigger {
  REMINDER_TRIGGER_UNSPECIFIED = 0,
  /** ON_AM04_RECEIVED - When AM04 rejection received */
  ON_AM04_RECEIVED = 1,
  /** BEFORE_RETRY - X days before scheduled retry */
  BEFORE_RETRY = 2,
  /** AFTER_RETRY_FAILED - After a retry attempt failed */
  AFTER_RETRY_FAILED = 3,
  /** AFTER_ALL_RETRIES_EXHAUSTED - All retries failed */
  AFTER_ALL_RETRIES_EXHAUSTED = 4,
  /** MANUAL - Manually triggered by admin */
  MANUAL = 5,
  UNRECOGNIZED = -1,
}

/** Policy defining retry behavior for a given context */
export interface RetryPolicy {
  id: string;
  organisationId: string;
  /** Scope (optional, for policy inheritance) */
  societeId?:
    | string
    | undefined;
  /** If set, applies to this product */
  productId?:
    | string
    | undefined;
  /** If set, applies to this channel */
  channelId?:
    | string
    | undefined;
  /** Policy name and description */
  name: string;
  description: string;
  /** Retry schedule (days after rejection) */
  retryDelaysDays: number[];
  /** Limits */
  maxAttempts: number;
  /** Maximum days from first rejection (default: 30) */
  maxTotalDays: number;
  /** Conditions */
  retryOnAm04: boolean;
  /** Additional retryable codes */
  retryableCodes: RejectionReasonCode[];
  /** Explicit non-retryable codes */
  nonRetryableCodes: RejectionReasonCode[];
  /** Stop conditions */
  stopOnPaymentSettled: boolean;
  /** Stop if contract cancelled */
  stopOnContractCancelled: boolean;
  /** Stop if mandate revoked */
  stopOnMandateRevoked: boolean;
  /** Backoff strategy (for future extensibility) */
  backoffStrategy: string;
  /** Active status */
  isActive: boolean;
  /** Default policy for organisation */
  isDefault: boolean;
  /** Priority (higher = more specific) */
  priority: number;
  /** Audit */
  createdAt: string;
  updatedAt: string;
  createdBy: string;
  updatedBy: string;
}

/** A retry schedule for a specific rejected payment */
export interface RetrySchedule {
  id: string;
  organisationId: string;
  societeId: string;
  /** Source payment reference */
  originalPaymentId: string;
  /** Reference to payment schedule */
  scheduleId: string;
  /** Invoice if applicable */
  factureId?:
    | string
    | undefined;
  /** Contract if applicable */
  contratId?:
    | string
    | undefined;
  /** Client reference */
  clientId: string;
  /** Rejection info */
  rejectionCode: RejectionReasonCode;
  /** Raw code from PSP */
  rejectionRawCode: string;
  rejectionMessage: string;
  rejectionDate?:
    | Date
    | undefined;
  /** Policy applied */
  retryPolicyId: string;
  /** Amount */
  amountCents: number;
  currency: string;
  /** Eligibility */
  eligibility: RetryEligibility;
  eligibilityReason: string;
  /** Current state */
  currentAttempt: number;
  maxAttempts: number;
  nextRetryDate?:
    | Date
    | undefined;
  /** Final outcome */
  isResolved: boolean;
  /** Why it was resolved */
  resolutionReason?: string | undefined;
  resolvedAt?:
    | Date
    | undefined;
  /** Idempotency */
  idempotencyKey: string;
  /** Audit */
  createdAt: string;
  updatedAt: string;
  metadata: { [key: string]: string };
}

export interface RetrySchedule_MetadataEntry {
  key: string;
  value: string;
}

/** Individual retry attempt */
export interface RetryAttempt {
  id: string;
  retryScheduleId: string;
  /** Attempt info */
  attemptNumber: number;
  plannedDate?: Date | undefined;
  executedAt?:
    | Date
    | undefined;
  /** Status */
  status: RetryAttemptStatus;
  /** Execution details */
  paymentIntentId?:
    | string
    | undefined;
  /** PSP payment reference */
  pspPaymentId?:
    | string
    | undefined;
  /** Raw PSP response (JSON) */
  pspResponse?:
    | string
    | undefined;
  /** Result */
  errorCode?: string | undefined;
  errorMessage?:
    | string
    | undefined;
  /** If failed with new code */
  newRejectionCode?:
    | RejectionReasonCode
    | undefined;
  /** Retry job reference */
  retryJobId?:
    | string
    | undefined;
  /** Idempotency */
  idempotencyKey: string;
  /** Audit */
  createdAt: string;
  updatedAt: string;
}

/** Batch job for scheduler execution */
export interface RetryJob {
  id: string;
  organisationId: string;
  /** Job parameters */
  targetDate?:
    | Date
    | undefined;
  /** Timezone for cutoff (e.g., "Europe/Paris") */
  timezone: string;
  /** Cutoff time (e.g., "10:00:00") */
  cutoffTime: string;
  /** Execution */
  scheduledAt?: Date | undefined;
  startedAt?: Date | undefined;
  completedAt?:
    | Date
    | undefined;
  /** Status */
  status: RetryJobStatus;
  /** Results */
  totalAttempts: number;
  successfulAttempts: number;
  failedAttempts: number;
  skippedAttempts: number;
  /** Error tracking */
  errorMessage?: string | undefined;
  failedScheduleIds: string[];
  /** Idempotency */
  idempotencyKey: string;
  /** Trigger */
  triggeredBy: string;
  isManual: boolean;
  /** Audit */
  createdAt: string;
  updatedAt: string;
}

/** Policy defining reminder behavior */
export interface ReminderPolicy {
  id: string;
  organisationId: string;
  /** Scope */
  societeId?:
    | string
    | undefined;
  /** Policy name */
  name: string;
  description: string;
  /** Trigger rules */
  triggerRules: ReminderTriggerRule[];
  /** Anti-spam / rate limiting */
  cooldownHours: number;
  /** Max reminders per day per client */
  maxRemindersPerDay: number;
  /** Max reminders per week per client */
  maxRemindersPerWeek: number;
  /** Time windows (hours in 24h format) */
  allowedStartHour: number;
  /** e.g., 19 (7:00 PM) */
  allowedEndHour: number;
  /** 0=Sunday, 1=Monday, ..., 6=Saturday */
  allowedDaysOfWeek: number[];
  /** Opt-out handling */
  respectOptOut: boolean;
  /** Active status */
  isActive: boolean;
  isDefault: boolean;
  priority: number;
  /** Audit */
  createdAt: string;
  updatedAt: string;
}

/** Trigger rule within a reminder policy */
export interface ReminderTriggerRule {
  id: string;
  trigger: ReminderTrigger;
  channel: ReminderChannel;
  /** Email/SMS template reference */
  templateId: string;
  /** Timing */
  delayHours: number;
  /** For BEFORE_RETRY trigger */
  daysBeforeRetry?:
    | number
    | undefined;
  /** Priority */
  order: number;
  /** Conditions */
  onlyIfNoResponse: boolean;
  /** Only on first AM04, not subsequent */
  onlyFirstRejection: boolean;
}

/** Individual reminder instance */
export interface Reminder {
  id: string;
  organisationId: string;
  societeId: string;
  /** References */
  retryScheduleId: string;
  /** If triggered by specific attempt */
  retryAttemptId?: string | undefined;
  clientId: string;
  /** Policy */
  reminderPolicyId: string;
  triggerRuleId: string;
  /** Channel and content */
  channel: ReminderChannel;
  templateId: string;
  templateVariables: { [key: string]: string };
  /** Trigger */
  trigger: ReminderTrigger;
  /** Scheduling */
  plannedAt?: Date | undefined;
  sentAt?: Date | undefined;
  deliveredAt?:
    | Date
    | undefined;
  /** Status */
  status: ReminderStatus;
  /** Delivery details */
  providerName?:
    | string
    | undefined;
  /** Provider's tracking ID */
  providerMessageId?:
    | string
    | undefined;
  /** Raw status from provider */
  deliveryStatusRaw?:
    | string
    | undefined;
  /** Error handling */
  errorCode?: string | undefined;
  errorMessage?:
    | string
    | undefined;
  /** Delivery retry count */
  retryCount: number;
  /** Idempotency */
  idempotencyKey: string;
  /** Audit */
  createdAt: string;
  updatedAt: string;
}

export interface Reminder_TemplateVariablesEntry {
  key: string;
  value: string;
}

/** Append-only audit log for all retry/reminder actions */
export interface RetryAuditLog {
  id: string;
  organisationId: string;
  /** What changed */
  entityType: string;
  entityId: string;
  /** "CREATED", "UPDATED", "STATUS_CHANGED", etc. */
  action: string;
  /** Change details */
  oldValue?:
    | string
    | undefined;
  /** JSON of new state */
  newValue: string;
  /** Comma-separated field names */
  changedFields?:
    | string
    | undefined;
  /** Context */
  retryScheduleId?: string | undefined;
  retryAttemptId?: string | undefined;
  reminderId?: string | undefined;
  paymentId?:
    | string
    | undefined;
  /** Actor */
  actorType: string;
  /** User ID if applicable */
  actorId?: string | undefined;
  actorIp: string;
  /** Timestamp (immutable) */
  timestamp?:
    | Date
    | undefined;
  /** Additional context */
  metadata: { [key: string]: string };
}

export interface RetryAuditLog_MetadataEntry {
  key: string;
  value: string;
}

/** Event: Payment rejected (input event) */
export interface PaymentRejectedEvent {
  eventId: string;
  organisationId: string;
  societeId: string;
  /** Payment info */
  paymentId: string;
  scheduleId: string;
  factureId?: string | undefined;
  contratId?: string | undefined;
  clientId: string;
  /** Rejection details */
  reasonCode: string;
  reasonMessage: string;
  /** Amount */
  amountCents: number;
  currency: string;
  /** PSP info */
  pspName: string;
  pspPaymentId?:
    | string
    | undefined;
  /** JSON */
  pspRawResponse?:
    | string
    | undefined;
  /** Timestamps */
  rejectedAt?: Date | undefined;
  eventTimestamp?:
    | Date
    | undefined;
  /** Idempotency */
  idempotencyKey: string;
}

/** Event: Retry scheduled */
export interface RetryScheduledEvent {
  eventId: string;
  retryScheduleId: string;
  retryAttemptId: string;
  attemptNumber: number;
  plannedDate?: Date | undefined;
  clientId: string;
  amountCents: number;
  currency: string;
  eventTimestamp?: Date | undefined;
}

/** Event: Retry executed */
export interface RetryExecutedEvent {
  eventId: string;
  retryScheduleId: string;
  retryAttemptId: string;
  attemptNumber: number;
  status: RetryAttemptStatus;
  paymentIntentId?: string | undefined;
  errorCode?: string | undefined;
  errorMessage?: string | undefined;
  executedAt?: Date | undefined;
  eventTimestamp?: Date | undefined;
}

/** Event: Retry succeeded */
export interface RetrySucceededEvent {
  eventId: string;
  retryScheduleId: string;
  retryAttemptId: string;
  attemptNumber: number;
  paymentIntentId: string;
  amountCents: number;
  currency: string;
  succeededAt?: Date | undefined;
  eventTimestamp?: Date | undefined;
}

/** Event: Retry failed */
export interface RetryFailedEvent {
  eventId: string;
  retryScheduleId: string;
  retryAttemptId: string;
  attemptNumber: number;
  errorCode: string;
  errorMessage: string;
  newRejectionCode?: RejectionReasonCode | undefined;
  hasMoreAttempts: boolean;
  nextRetryDate?: Date | undefined;
  failedAt?: Date | undefined;
  eventTimestamp?: Date | undefined;
}

/** Event: Retry cancelled */
export interface RetryCancelledEvent {
  eventId: string;
  retryScheduleId: string;
  retryAttemptId?: string | undefined;
  cancellationReason: string;
  /** User ID or "SYSTEM" */
  cancelledBy: string;
  cancelledAt?: Date | undefined;
  eventTimestamp?: Date | undefined;
}

/** Event: Reminder planned */
export interface ReminderPlannedEvent {
  eventId: string;
  reminderId: string;
  retryScheduleId: string;
  channel: ReminderChannel;
  trigger: ReminderTrigger;
  plannedAt?: Date | undefined;
  clientId: string;
  eventTimestamp?: Date | undefined;
}

/** Event: Reminder sent */
export interface ReminderSentEvent {
  eventId: string;
  reminderId: string;
  channel: ReminderChannel;
  providerName: string;
  providerMessageId?: string | undefined;
  sentAt?: Date | undefined;
  eventTimestamp?: Date | undefined;
}

/** Event: Reminder failed */
export interface ReminderFailedEvent {
  eventId: string;
  reminderId: string;
  channel: ReminderChannel;
  errorCode: string;
  errorMessage: string;
  retryCount: number;
  willRetry: boolean;
  failedAt?: Date | undefined;
  eventTimestamp?: Date | undefined;
}

/** Event: Reminder cancelled */
export interface ReminderCancelledEvent {
  eventId: string;
  reminderId: string;
  cancellationReason: string;
  cancelledBy: string;
  cancelledAt?: Date | undefined;
  eventTimestamp?: Date | undefined;
}

/** Typed error responses */
export interface RetryError {
  code: string;
  message: string;
  details: { [key: string]: string };
}

export interface RetryError_DetailsEntry {
  key: string;
  value: string;
}
