/**
 * Commission Types - Bridge file between gRPC generated types and frontend needs
 *
 * This file:
 * 1. Re-exports gRPC base types (Commission, Bareme, Palier, etc.)
 * 2. Provides frontend-friendly string literal types for enums
 * 3. Adds enriched types (WithDetails) not generated by protobuf
 * 4. Maintains backward compatibility with existing component code
 */

// ============================================
// Re-export gRPC base types
// ============================================
export type {
  Commission,
  Bareme,
  Palier,
  Bordereau,
  LigneBordereau,
  Reprise,
  StatutCommission,
  // Request types
  CreateCommissionRequest,
  UpdateCommissionRequest,
  GetCommissionsRequest,
  CreateBaremeRequest,
  UpdateBaremeRequest,
  GetBaremesRequest,
  GetBaremeApplicableRequest,
  CreatePalierRequest,
  UpdatePalierRequest,
  CreateBordereauRequest,
  UpdateBordereauRequest,
  ValidateBordereauRequest,
  GetBordereauxRequest,
  CreateRepriseRequest,
  GetReprisesRequest,
  ApplyRepriseRequest,
  CalculerCommissionRequest,
  GenererBordereauRequest,
  DeclencherRepriseRequest,
  // Response types
  CommissionResponse,
  CommissionListResponse,
  BaremeResponse,
  BaremeListResponse,
  PalierResponse,
  PalierListResponse,
  BordereauResponse,
  BordereauListResponse,
  LigneBordereauResponse,
  LigneBordereauListResponse,
  RepriseResponse,
  RepriseListResponse,
  StatutResponse,
  StatutListResponse,
  ExportBordereauResponse,
  CalculerCommissionResponse,
  GenererBordereauResponse,
  BordereauSummary,
  PrimeApplicable,
} from "@proto-grpc/commission/commission";

// Re-export gRPC enums (for use with fromJSON/toJSON converters)
export {
  TypeCalcul as TypeCalculEnum,
  BaseCalcul as BaseCalculEnum,
  TypePalier as TypePalierEnum,
  StatutBordereau as StatutBordereauEnum,
  TypeLigne as TypeLigneEnum,
  StatutLigne as StatutLigneEnum,
  TypeReprise as TypeRepriseEnum,
  StatutReprise as StatutRepriseEnum,
  // Converters
  typeCalculFromJSON,
  typeCalculToJSON,
  baseCalculFromJSON,
  baseCalculToJSON,
  typePalierFromJSON,
  typePalierToJSON,
  statutBordereauFromJSON,
  statutBordereauToJSON,
  typeLigneFromJSON,
  typeLigneToJSON,
  statutLigneFromJSON,
  statutLigneToJSON,
  typeRepriseFromJSON,
  typeRepriseToJSON,
  statutRepriseFromJSON,
  statutRepriseToJSON,
} from "@proto-grpc/commission/commission";

// ============================================
// Frontend-friendly string literal types
// These match the values actually sent/received by the API
// ============================================
export type TypeApporteur = "vrp" | "manager" | "directeur" | "partenaire";
export type TypeBase = "cotisation_ht" | "ca_ht" | "forfait";
export type TypeCalcul = "fixe" | "pourcentage" | "palier" | "mixte";
export type TypePalier = "volume" | "ca" | "prime_produit";
export type TypeProduit =
  | "telecom"
  | "assurance_sante"
  | "prevoyance"
  | "energie"
  | "depanssur"
  | "mondial_tv"
  | "conciergerie";
export type CanalVente = "terrain" | "web" | "televente";
export type TypeReprise = "resiliation" | "impaye" | "annulation" | "regularisation";
export type StatutReprise = "en_attente" | "appliquee" | "annulee";
export type StatutBordereau = "brouillon" | "valide" | "exporte" | "archive";
export type TypeLigne = "commission" | "reprise" | "acompte" | "prime" | "regularisation";
export type StatutLigne = "selectionnee" | "deselectionnee" | "validee" | "rejetee";

// ============================================
// Enriched types for frontend display
// These include joined/nested data not in base gRPC types
// ============================================

/** Apporteur info for display */
export interface ApporteurInfo {
  id: string;
  nom: string;
  prenom: string;
  typeApporteur: TypeApporteur;
}

/** Contrat info for display */
export interface ContratInfo {
  id: string;
  referenceExterne: string;
  clientNom: string;
}

/** Produit info for display */
export interface ProduitInfo {
  id: string;
  nom: string;
  sku: string;
}

/** Statut info for display */
export interface StatutInfo {
  id: string;
  code: string;
  nom: string;
}

/** Commission with all related entities for detail views */
export interface CommissionWithDetails {
  id: string;
  organisationId: string;
  reference: string;
  compagnie: string;
  typeBase: TypeBase;
  montantBrut: number;
  montantReprises: number;
  montantAcomptes: number;
  montantNetAPayer: number;
  periode: string;
  dateCreation: Date | string;
  apporteur: ApporteurInfo | null;
  contrat: ContratInfo | null;
  produit: ProduitInfo | null;
  statut: StatutInfo | null;
  createdAt: Date | string;
  updatedAt: Date | string;
}

/** Bordereau with apporteur info */
export interface BordereauWithDetails {
  id: string;
  organisationId: string;
  reference: string;
  periode: string;
  apporteurId: string;
  totalBrut: number;
  totalReprises: number;
  totalAcomptes: number;
  totalNetAPayer: number;
  nombreLignes: number;
  statutBordereau: StatutBordereau;
  dateValidation: Date | string | null;
  validateurId: string | null;
  dateExport: Date | string | null;
  fichierPdfUrl: string | null;
  fichierExcelUrl: string | null;
  commentaire: string | null;
  creePar: string | null;
  createdAt: Date | string;
  updatedAt: Date | string;
  apporteur: ApporteurInfo | null;
}

/** Reprise with related info */
export interface RepriseWithDetails {
  id: string;
  organisationId: string;
  commissionOriginaleId: string;
  contratId: string;
  apporteurId: string;
  reference: string;
  typeReprise: TypeReprise;
  montantReprise: number;
  tauxReprise: number;
  montantOriginal: number;
  periodeOrigine: string;
  periodeApplication: string;
  dateEvenement: Date | string;
  dateLimite: Date | string;
  dateApplication: Date | string | null;
  statutReprise: StatutReprise;
  bordereauId: string | null;
  motif: string | null;
  commentaire: string | null;
  createdAt: Date | string;
  updatedAt: Date | string;
  apporteur: ApporteurInfo | null;
  contrat: ContratInfo | null;
}

/** Bareme with paliers for configuration view */
export interface BaremeWithPaliers {
  id: string;
  organisationId: string;
  code: string;
  nom: string;
  description: string | null;
  typeCalcul: TypeCalcul;
  baseCalcul: TypeBase;
  montantFixe: number | null;
  tauxPourcentage: number | null;
  precomptee?: boolean;
  recurrenceActive: boolean;
  tauxRecurrence: number | null;
  dureeRecurrenceMois: number | null;
  dureeReprisesMois: number;
  tauxReprise: number;
  typeProduit: TypeProduit | string | null;
  gammeId: string | null;
  produitId: string | null;
  profilRemuneration: TypeApporteur | string | null;
  societeId: string | null;
  canalVente: CanalVente | string | null;
  repartitionCommercial: number;
  repartitionManager: number;
  repartitionAgence: number;
  repartitionEntreprise: number;
  version: number;
  dateEffet: Date | string;
  dateFin: Date | string | null;
  actif: boolean;
  creePar: string | null;
  modifiePar: string | null;
  motifModification: string | null;
  createdAt: Date | string;
  updatedAt: Date | string;
  paliers?: PalierDisplay[];
}

/** Palier for display */
export interface PalierDisplay {
  id: string;
  organisationId: string;
  baremeId: string;
  code: string;
  nom: string;
  description: string | null;
  typePalier: TypePalier;
  seuilMin: number;
  seuilMax: number | null;
  montantPrime: number;
  tauxBonus: number | null;
  cumulable: boolean;
  parPeriode: boolean;
  typeProduit: TypeProduit | null;
  gammeId?: string | null;
  produitId?: string | null;
  ordre: number;
  actif: boolean;
  createdAt: Date | string;
  updatedAt: Date | string;
}

// ============================================
// Filter types for queries
// ============================================
export interface CommissionFilters {
  organisationId?: string;
  apporteurId?: string;
  periode?: string;
  statutId?: string;
}

export interface BaremeFilters {
  organisationId?: string;
  actifs?: boolean;
  typeProduit?: TypeProduit;
}

export interface BordereauFilters {
  organisationId?: string;
  apporteurId?: string;
  periode?: string;
  statut?: StatutBordereau;
}

export interface RepriseFilters {
  organisationId?: string;
  apporteurId?: string;
  contratId?: string;
  periode?: string;
  enAttente?: boolean;
}

export interface PalierFilters {
  organisationId?: string;
  baremeId?: string;
  actifs?: boolean;
}

// ============================================
// Summary types for UI
// ============================================
export interface CommissionSummary {
  totalBrut: number;
  totalReprises: number;
  totalAcomptes: number;
  totalNet: number;
  nombreLignes: number;
  nombreSelectionnes: number;
}

// ============================================
// Apporteur types (included here for convenience)
// ============================================
export interface ApporteurResponse {
  id: string;
  organisationId: string;
  utilisateurId?: string | null;
  nom: string;
  prenom: string;
  typeApporteur: TypeApporteur;
  email?: string | null;
  telephone?: string | null;
  actif: boolean;
  createdAt: Date | string;
  updatedAt: Date | string;
}

export interface CreateApporteurDto {
  organisationId: string;
  nom: string;
  prenom: string;
  typeApporteur: TypeApporteur;
  email?: string;
  telephone?: string;
}

export interface UpdateApporteurDto {
  nom?: string;
  prenom?: string;
  typeApporteur?: TypeApporteur;
  email?: string;
  telephone?: string;
  actif?: boolean;
}

// ============================================
// Type aliases for backward compatibility
// These allow existing code to work without changes
// ============================================

// Response DTO aliases
export type ApporteurResponseDto = ApporteurResponse;
export type StatutCommissionResponseDto = StatutInfo & {
  description?: string | null;
  ordreAffichage: number;
  createdAt: Date | string;
  updatedAt: Date | string;
};
export type CommissionWithDetailsResponseDto = CommissionWithDetails;
export type BordereauWithDetailsResponseDto = BordereauWithDetails;
export type BaremeCommissionResponseDto = BaremeWithPaliers;
export type PalierCommissionResponseDto = PalierDisplay;
export type RepriseCommissionResponseDto = RepriseWithDetails;
export type BordereauCommissionResponseDto = BordereauWithDetails;
export type LigneBordereauResponseDto = {
  id: string;
  organisationId: string;
  bordereauId: string;
  commissionId: string | null;
  repriseId: string | null;
  typeLigne: TypeLigne;
  contratId: string;
  contratReference: string;
  clientNom: string | null;
  produitNom: string | null;
  montantBrut: number;
  montantReprise: number;
  montantNet: number;
  baseCalcul: TypeBase | null;
  tauxApplique: number | null;
  baremeId: string | null;
  statutLigne: StatutLigne;
  selectionne: boolean;
  motifDeselection: string | null;
  validateurId: string | null;
  dateValidation: Date | string | null;
  ordre: number;
  createdAt: Date | string;
  updatedAt: Date | string;
};

// CalculerCommission response for frontend
export interface CalculerCommissionResponseDto {
  commission: CommissionWithDetails | null;
  bareme: BaremeWithPaliers | null;
  primes: PalierDisplay[];
  erreur?: string;
}

// Filter DTO aliases
export type CommissionFiltersDto = CommissionFilters;
export type BaremeFiltersDto = BaremeFilters;
export type BordereauFiltersDto = BordereauFilters;
export type RepriseFiltersDto = RepriseFilters;
export type PalierFiltersDto = PalierFilters;
export type LigneBordereauFiltersDto = {
  bordereauId: string;
  selectionnees?: boolean;
};

// Summary alias
export type CommissionSummaryDto = CommissionSummary;

// ============================================
// Additional Filter types
// ============================================
export interface ApporteurFilters {
  organisationId?: string;
}

export interface BaremeApplicableFiltersDto {
  organisationId: string;
  typeProduit?: TypeProduit;
  profilRemuneration?: TypeApporteur;
}

export interface PalierApplicableFiltersDto {
  baremeId: string;
  typePalier: TypePalier;
  valeur: number;
}

// ============================================
// Commission Engine DTOs
// ============================================
export interface CalculerCommissionDto {
  organisationId: string;
  contratId: string;
  apporteurId: string;
  periode: string;
  montantBase: number;
  typeProduit?: TypeProduit;
}

export interface GenererBordereauDto {
  organisationId: string;
  apporteurId: string;
  periode: string;
  commissionIds?: string[];
}

export interface GenererBordereauResponseDto {
  bordereau: BordereauWithDetails;
  lignes: LigneBordereauResponseDto[];
  nombreCommissions: number;
  nombreReprises: number;
  totalBrut: number;
  totalReprises: number;
  totalNet: number;
}

export interface DeclencherRepriseDto {
  organisationId: string;
  commissionId: string;
  typeReprise: TypeReprise;
  motif?: string;
  commentaire?: string;
}

// ============================================
// Mutation DTOs
// ============================================
export interface AnnulerRepriseDto {
  motif: string;
}

export interface ValiderBordereauDto {
  commentaire?: string;
}

export interface CreateBaremeDto {
  organisationId: string;
  code: string;
  nom: string;
  description?: string;
  typeCalcul: TypeCalcul;
  baseCalcul: TypeBase;
  montantFixe?: number;
  tauxPourcentage?: number;
  precomptee?: boolean;
  recurrenceActive?: boolean;
  tauxRecurrence?: number;
  dureeRecurrenceMois?: number;
  dureeReprisesMois?: number;
  tauxReprise?: number;
  typeProduit?: string;
  gammeId?: string;
  produitId?: string;
  profilRemuneration?: string;
  societeId?: string;
  canalVente?: CanalVente;
  repartitionCommercial?: number;
  repartitionManager?: number;
  repartitionAgence?: number;
  repartitionEntreprise?: number;
  dateEffet: string;
  dateFin?: string;
}

export interface UpdateBaremeDto {
  nom?: string;
  description?: string;
  typeCalcul?: TypeCalcul;
  baseCalcul?: TypeBase;
  montantFixe?: number;
  tauxPourcentage?: number;
  precomptee?: boolean;
  recurrenceActive?: boolean;
  tauxRecurrence?: number;
  dureeRecurrenceMois?: number;
  dureeReprisesMois?: number;
  tauxReprise?: number;
  typeProduit?: string;
  gammeId?: string;
  produitId?: string;
  profilRemuneration?: string;
  societeId?: string;
  canalVente?: CanalVente;
  repartitionCommercial?: number;
  repartitionManager?: number;
  repartitionAgence?: number;
  repartitionEntreprise?: number;
  dateFin?: string;
  actif?: boolean;
  motifModification?: string;
}

export interface CreatePalierDto {
  organisationId: string;
  baremeId: string;
  code: string;
  nom: string;
  description?: string;
  typePalier: TypePalier;
  seuilMin: number;
  seuilMax?: number;
  montantPrime: number;
  tauxBonus?: number;
  cumulable?: boolean;
  parPeriode?: boolean;
  typeProduit?: string;
  gammeId?: string;
  produitId?: string;
  ordre?: number;
}

export interface UpdatePalierDto {
  code?: string;
  nom?: string;
  description?: string;
  typePalier?: TypePalier;
  seuilMin?: number;
  seuilMax?: number;
  montantPrime?: number;
  tauxBonus?: number;
  cumulable?: boolean;
  parPeriode?: boolean;
  typeProduit?: string;
  gammeId?: string;
  produitId?: string;
  ordre?: number;
  actif?: boolean;
}

// ============================================
// Base Commission response (without relations)
// ============================================
export interface CommissionResponseDto {
  id: string;
  organisationId: string;
  reference: string;
  apporteurId: string;
  contratId: string;
  produitId?: string | null;
  compagnie: string;
  typeBase: TypeBase;
  montantBrut: number;
  montantReprises: number;
  montantAcomptes: number;
  montantNetAPayer: number;
  statutId: string;
  periode: string;
  dateCreation: Date | string;
  createdAt: Date | string;
  updatedAt: Date | string;
}
